#!/usr/bin/env bash

USAGE=""
LONG_USAGE="Switch between most recent branches."

source "$(git --exec-path)/git-sh-setup"

function main() {
    branches=$(git for-each-ref --sort=-committerdate refs/heads/ | grep -oE 'refs/heads/(.+)$' | tr -d " " | tr "\n" " ")
    branches=${branches//refs\/heads\/}
    IFS=' ' read -r -a branches_array <<< "$branches"

    i=1
    for branch in "${branches_array[@]}"; do
        echo "$i: $branch"
        let "i++"
    done

    if [[ ${#branches_array[@]} -lt 10 ]]; then
        read -n1 -p "Switch to branch number: " -r
        echo
    else
        read -p "Switch to branch number: " -r
    fi

    selected_branch=$((REPLY-1))
    git checkout ${branches_array[$selected_branch]}
}

main